<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>[HELIOS] $17 Million NTC Competition Leaderboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet"/>
  <style>
    .font-lato { font-family: 'Lato', sans-serif; }
    th.sortable { cursor: pointer; user-select: none; }

    /* Suns background under rows but above hover backgrounds */
    .table-with-suns {
      position: relative;
      overflow: hidden;
    }
    .table-with-suns::after {
      content: '';
      position: absolute;
      inset: 0;
      background: url('assets/suns.png') center/cover no-repeat;
      opacity: 0.07;
      pointer-events: none;
      z-index: 1;
    }
    .table-with-suns tr { position: relative; z-index: 0; }
    .table-with-suns th, .table-with-suns td { position: relative; z-index: 2; }
  </style>
</head>
<body class="bg-slate-900 text-gray-200 font-sans min-h-screen p-8">
  <h1 class="text-4xl font-extrabold mb-2 text-yellow-400">
    [HELIOS] $17 Million NTC Competition Leaderboard
  </h1>
  <p class="text-sm italic text-gray-400 mb-6">
    Last updated: <span id="updated-at" class="font-mono">Loading…</span>
  </p>

  <div class="flex space-x-6">
    <!-- LEFT: Tabs + Leaderboard -->
    <div class="w-3/4">
      <!-- Top Tabs -->
      <div class="flex mb-0">
        <button id="tab-tourney"
                class="px-4 py-2 rounded-t-lg border border-slate-700 border-b-0">
          Tournament
        </button>
        <button id="tab-streak"
                class="px-4 py-2 rounded-t-lg border border-slate-700 border-b-0 ml-2">
          Streaks
        </button>
      </div>
      <!-- Panel under tabs -->
      <div class="bg-slate-800 border border-slate-700 border-t-0 rounded-b-lg rounded-tr-lg overflow-hidden">
        <!-- Sub-tabs -->
        <div class="flex border-b border-slate-700 px-4 py-2">
          <div id="sub-tourney" class="flex">
            <button id="sub-date"
                    class="px-3 py-1 text-sm rounded-t bg-slate-700 text-yellow-400">
              6/26/25 – 7/23/25
            </button>
          </div>
          <div id="sub-streaks" class="hidden flex border border-slate-700 bg-slate-700 rounded-lg overflow-hidden ml-2">
            <button id="sub-current"
                    class="flex-1 px-3 py-1 text-sm bg-transparent text-gray-400 hover:bg-yellow-400 hover:text-white">
              Current
            </button>
            <button id="sub-all"
                    class="flex-1 px-3 py-1 text-sm bg-transparent text-gray-400 hover:bg-yellow-400 hover:text-white">
              All Time
            </button>
          </div>
        </div>
        <!-- Table container -->
        <div id="table-container" class="table-with-suns">
          <table class="min-w-full rounded-b-lg">
            <thead id="leaderboard-head" class="bg-slate-700"></thead>
            <tbody id="leaderboard-body" class="divide-y divide-slate-700"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- RIGHT: Info Boxes (unchanged) -->
    <div class="w-1/4 space-y-6">
      <!-- ... -->
    </div>
  </div>

  <script>
    // Countdown code unchanged...
    // State & Sorting Flags...
    // Tab styling helpers...

    function updateSubtabs(){
      const sd = document.getElementById('sub-date'),
            sc = document.getElementById('sub-current'),
            sa = document.getElementById('sub-all');
      if(mode==='tourney'){
        sd.className = 'px-3 py-1 text-sm rounded-t bg-slate-700 text-yellow-400';
      } else {
        // selected tab: faded gold bg + white text
        sc.className = streakView==='current'
          ? 'flex-1 px-3 py-1 text-sm bg-yellow-400/50 text-white'
          : 'flex-1 px-3 py-1 text-sm bg-transparent text-gray-400 hover:bg-yellow-400 hover:text-white';
        sa.className = streakView==='allTime'
          ? 'flex-1 px-3 py-1 text-sm bg-yellow-400/50 text-white'
          : 'flex-1 px-3 py-1 text-sm bg-transparent text-gray-400 hover:bg-yellow-400 hover:text-white';
      }
    }

    // Initial Fetch & Wireup...
    document.addEventListener('DOMContentLoaded', ()=>{
      // tab click handlers...

      fetch(/* … */)
        .then(r => r.json())
        .then(d => {
          data = d;
          // compute tournament ranks...
          // compute streak ranks + merge titles + racedToday flag assumed in JSON...
          render();
        });
    });

    // Render dispatcher...
    function renderStreakHead(){
      document.getElementById('leaderboard-head').innerHTML = `
        <tr>
          <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">#</th>
          <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">Name & Title</th>
          <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">Role</th>
          <th class="px-4 py-3 text-center text-sm font-medium text-gray-300">Today</th>
          <th id="th-start"  class="px-4 py-3 text-left text-sm font-medium text-gray-300 sortable">
            Start <span>${streakSort.key==='start'?(streakSort.dir>0?'▲':'▼'):'▼'}</span>
          </th>
          <th id="th-end"    class="px-4 py-3 text-left text-sm font-medium text-gray-300 sortable">
            End <span>${streakSort.key==='end'?(streakSort.dir>0?'▲':'▼'):'▼'}</span>
          </th>
          <th id="th-length" class="px-4 py-3 text-right text-sm font-medium text-gray-300 sortable">
            Length <span>${streakSort.key==='length'?(streakSort.dir>0?'▲':'▼'):'▼'}</span>
          </th>
        </tr>`;
      ['start','end','length'].forEach(k=>{
        document.getElementById(`th-${k}`).onclick = ()=>{
          if(streakSort.key===k) streakSort.dir *= -1;
          else { streakSort.key=k; streakSort.dir=1; }
          render();
        };
      });
    }

    function renderStreakBody(){
      const list = [...(data.streaks[streakView]||[])];
      list.sort((a,b)=>{
        let av=0,bv=0;
        if(streakSort.key==='length'){ av=a.length; bv=b.length; }
        else if(streakSort.key==='start'){ av=a.start||0; bv=b.start||0; }
        else { av=a.end||0; bv=b.end||0; }
        return streakSort.dir * (av - bv);
      });

      const tb = document.getElementById('leaderboard-body');
      tb.innerHTML = '';
      list.forEach(it=>{
        const rank = it.initialRank;
        let base='', hover='hover:bg-slate-700';
        if(rank===1){ base='bg-yellow-400/20'; hover='hover:bg-yellow-400/10'; }
        else if(rank===2){ base='bg-yellow-500/20'; hover='hover:bg-yellow-500/10'; }
        else if(rank===3){ base='bg-yellow-600/20'; hover='hover:bg-yellow-600/10'; }

        let ord = `${rank}`;
        if(rank===1) ord=`<img src="assets/1st.png" alt="1st" class="h-6 inline"/>`;
        if(rank===2) ord=`<img src="assets/2nd.png" alt="2nd" class="h-6 inline"/>`;
        if(rank===3) ord=`<img src="assets/3rd.png" alt="3rd" class="h-6 inline"/>`;

        const key = it.role.toLowerCase().replace(/\s+/g,'');
        const rc = {
          officer:     'border-2 border-blue-400 text-blue-400 bg-transparent',
          captain:     'border-2 border-purple-400 text-purple-400 bg-transparent',
          vicecaptain: 'border-2 border-green-400 text-green-400 bg-transparent',
          member:      'text-gray-400'
        };
        const badge = rc[key]||rc.member;
        let label = it.role.charAt(0).toUpperCase()+it.role.slice(1);
        if(key==='vicecaptain') label='Vice Captain';

        const sd = it.start ? new Date(it.start).toLocaleDateString() : 'N/A';
        const ed = it.end   ? new Date(it.end  ).toLocaleDateString() : 'N/A';

        const tc = rank<=3? 'text-yellow-400/70':'text-gray-400';
        const titleHtml = it.title
          ? `<div class="text-xs ${tc} mt-1">${it.title}</div>` : '';

        // new Today cell
        const todayHtml = it.racedToday
          ? '<span class="text-green-400">✔︎</span>'
          : '<span class="text-gray-500">—</span>';

        const tr = document.createElement('tr');
        tr.className = `cursor-pointer ${base} ${hover} align-middle`;
        tr.onclick  = ()=> window.open(`https://www.nitrotype.com/racer/${it.username}`,'_blank');
        tr.title    = 'View Nitro Type profile';
        tr.innerHTML=`
          <td class="px-4 py-3">${ord}</td>
          <td class="px-4 py-3 text-yellow-300 font-semibold">
            ${it.displayName}${titleHtml}
          </td>
          <td class="px-4 py-3">
            <span class="px-2 py-0.5 rounded ${badge} text-xs font-medium">${label}</span>
          </td>
          <td class="px-4 py-3 text-center">${todayHtml}</td>
          <td class="px-4 py-3">${sd}</td>
          <td class="px-4 py-3">${ed}</td>
          <td class="px-4 py-3 text-right">${it.length||0}</td>
        `;
        tb.appendChild(tr);
      });
    }
  </script>
</body>
</html>
