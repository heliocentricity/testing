<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>[HELIOS] $17 Million NTC Competition Leaderboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet"/>
  <style>
    .font-lato { font-family: 'Lato', sans-serif; }
    th.sortable { cursor: pointer; user-select: none; }

    /* Suns background under rows but above hover backgrounds */
    .table-with-suns {
      position: relative;
      overflow: hidden;
    }
    .table-with-suns::after {
      content: '';
      position: absolute;
      inset: 0;
      background: url('assets/suns.png') center/cover no-repeat;
      opacity: 0.07;
      pointer-events: none;
      z-index: 1;
    }
    .table-with-suns tr { position: relative; z-index: 0; }
    .table-with-suns th, .table-with-suns td { position: relative; z-index: 2; }
  </style>
</head>
<body class="bg-slate-900 text-gray-200 min-h-screen p-8 font-sans">
  <h1 class="text-4xl font-extrabold mb-2 text-yellow-400">
    [HELIOS] $17 Million NTC Competition Leaderboard
  </h1>
  <p class="text-sm italic text-gray-400 mb-6">
    Last updated: <span id="updated-at" class="font-mono">Loading…</span>
  </p>

  <div class="flex space-x-6">
    <!-- Left: tabbed leaderboard -->
    <div class="w-3/4">
      <!-- Container for tabs + subtabs + table -->
      <div id="tab-container" class="relative bg-slate-800 rounded-lg mb-6">
        <!-- Top tabs -->
        <div id="tabs" class="flex">
          <button id="tab-tourney"
                  class="flex-1 px-4 py-2 rounded-t-lg text-center">
            Tournament
          </button>
          <button id="tab-streak"
                  class="flex-1 px-4 py-2 rounded-t-lg text-center">
            Streaks
          </button>
        </div>
        <!-- Sub-tabs -->
        <div id="subtabs" class="flex border-b border-slate-700">
          <!-- Tournament has one date-range button -->
          <div id="sub-tourney" class="flex w-full">
            <button id="sub-date"
                    class="flex-1 px-2 py-1 text-xs text-center">
              6/26/25 – 7/23/25
            </button>
          </div>
          <!-- Streaks has two: Current / All Time -->
          <div id="sub-streaks" class="hidden flex w-full">
            <button id="sub-current"
                    class="flex-1 px-2 py-1 text-sm text-center">
              Current
            </button>
            <button id="sub-all"
                    class="flex-1 px-2 py-1 text-sm text-center">
              All Time
            </button>
          </div>
        </div>
        <!-- Table -->
        <div id="table-container" class="table-with-suns overflow-x-auto rounded-b-lg">
          <table class="min-w-full">
            <thead id="leaderboard-head" class="bg-slate-700"></thead>
            <tbody id="leaderboard-body" class="divide-y divide-slate-700"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Right: info boxes (unchanged) -->
    <div class="w-1/4 space-y-6">
      <!-- ... your countdown, prizes, description, links, credits ... -->
      <!-- (omitted for brevity; keep exactly as before) -->
    </div>
  </div>

  <script>
    // Countdown (unchanged)…
    const cdEl = document.getElementById('countdown'),
          btn  = document.getElementById('toggle-countdown');
    let exact = true;
    function updateCd() {
      const end  = new Date('2025-07-23T08:00:00-07:00'),
            diff = Math.max(0, end - new Date()),
            days = Math.floor(diff/86400000),
            hrs  = Math.floor((diff%86400000)/3600000),
            mins = Math.floor((diff%3600000)/60000),
            secs = Math.floor((diff%60000)/1000);
      cdEl.textContent = exact
        ? `${String(days).padStart(2,'0')}:${String(hrs).padStart(2,'0')}:`
          +`${String(mins).padStart(2,'0')}:${String(secs).padStart(2,'0')}`
        : days;
    }
    btn.addEventListener('click', ()=>{
      exact = !exact;
      btn.textContent = exact ? 'Show days only' : 'Show exact countdown';
      updateCd();
    });
    setInterval(updateCd,1000);
    updateCd();

    // State & sorting
    let data = null,
        mode = 'tourney',
        streakView = 'current',
        tourneySort = { join:false, last:false, races:false },
        streakSort = { start:false, end:false, length:false };

    // Tab controls
    function updateTabs(){
      const t1 = document.getElementById('tab-tourney'),
            t2 = document.getElementById('tab-streak'),
            st = document.getElementById('sub-tourney'),
            ss = document.getElementById('sub-streaks');

      if(mode==='tourney'){
        t1.className = 'flex-1 px-4 py-2 rounded-t-lg bg-slate-800 text-yellow-400';
        t2.className = 'flex-1 px-4 py-2 rounded-t-lg bg-slate-700 text-gray-400 hover:bg-slate-600';
        st.classList.remove('hidden');
        ss.classList.add('hidden');
      } else {
        t1.className = 'flex-1 px-4 py-2 rounded-t-lg bg-slate-700 text-gray-400 hover:bg-slate-600';
        t2.className = 'flex-1 px-4 py-2 rounded-t-lg bg-slate-800 text-yellow-400';
        st.classList.add('hidden');
        ss.classList.remove('hidden');
      }
    }

    function updateSubtabs(){
      if(mode==='tourney'){
        document.getElementById('sub-date')
                .className = 'flex-1 px-2 py-1 bg-slate-700 text-yellow-400';
      } else {
        document.getElementById('sub-current')
                .className = streakView==='current'
                  ? 'flex-1 px-2 py-1 bg-slate-700 text-yellow-400'
                  : 'flex-1 px-2 py-1 bg-slate-700 text-gray-400 hover:text-yellow-400';
        document.getElementById('sub-all')
                .className = streakView==='allTime'
                  ? 'flex-1 px-2 py-1 bg-slate-700 text-yellow-400'
                  : 'flex-1 px-2 py-1 bg-slate-700 text-gray-400 hover:text-yellow-400';
      }
    }

    // Main render dispatcher
    function render(){
      if(!data) return;
      updateTabs();
      updateSubtabs();
      if(mode==='tourney'){
        renderTourneyHead();
        renderTourneyBody();
      } else {
        renderStreakHead();
        renderStreakBody();
      }
    }

    // Fetch data.json relative to this page
    document.addEventListener('DOMContentLoaded', ()=>{
      document.getElementById('tab-tourney').onclick = ()=>{
        mode='tourney'; render();
      };
      document.getElementById('tab-streak').onclick = ()=>{
        mode='streak'; render();
      };
      document.getElementById('sub-current').onclick = ()=>{
        streakView='current'; render();
      };
      document.getElementById('sub-all').onclick = ()=>{
        streakView='allTime'; render();
      };

      const p = window.location.pathname.split('/');
      p.pop();
      const base = (p.join('/')||'/').replace(/\/$/,'');

      fetch(`${base}/data.json`)
        .then(r=> r.ok? r.json(): Promise.reject(r.status))
        .then(d=>{
          data = d;
          document.getElementById('updated-at')
                  .textContent = d.last_updated || 'Unknown';
          render();
        })
        .catch(e=>{
          console.error('Failed to load data.json',e);
          document.getElementById('updated-at')
                  .textContent = 'Error';
        });
    });

    // … (renderTourneyHead, renderTourneyBody,
    //     renderStreakHead, renderStreakBody as before,
    //     identical styling for both) …
  </script>
</body>
</html>
